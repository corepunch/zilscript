name: Run Tests

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Install Lua
      run: |
        sudo apt-get update
        sudo apt-get install -y lua5.4
    
    - name: Run unit tests
      run: lua tests/unit/run_all.lua
    
    - name: Run Zork1 basic tests
      run: lua tests/run_tests.lua tests/zork1_basic.lua
    
    - name: Run Zork1 walkthrough tests
      run: lua tests/run_tests.lua tests/zork1_walkthrough.lua

    - name: Run Horror walkthrough tests
      run: lua tests/run_tests.lua tests/horror-walkthrough.lua

    - name: Run horror failing conditions tests
      run: lua5.4 run-zil-test.lua tests.test-horror-failures

    - name: Run parser/runtime tests - directions
      run: lua5.4 run-zil-test.lua tests.test-directions
    
    - name: Run parser/runtime tests - take
      run: lua5.4 run-zil-test.lua tests.test-take
    
    - name: Run parser/runtime tests - containers
      run: lua5.4 run-zil-test.lua tests.test-containers
    
    - name: Run parser/runtime tests - light
      run: lua5.4 run-zil-test.lua tests.test-light
    
    - name: Run parser/runtime tests - pronouns
      run: lua5.4 run-zil-test.lua tests.test-pronouns
    
    - name: Run parser/runtime tests - clock
      run: lua5.4 run-zil-test.lua tests.test-clock
    
    - name: Run test assertion tests
      run: lua5.4 run-zil-test.lua tests.test-assertions
    
    - name: Run test check commands tests
      run: lua5.4 run-zil-test.lua tests.test-check-commands
    
    - name: Run horror test helpers
      run: lua5.4 run-zil-test.lua tests.test-horror-helpers
