name: Run Tests

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Install Lua
      run: |
        sudo apt-get update
        sudo apt-get install -y lua5.4
    
    - name: Run unit tests
      run: lua5.4 tests/unit/run_all.lua
    
    - name: Run Zork1 walkthrough tests
      run: lua5.4 run-zil-test.lua tests.zork1-walkthrough

    - name: Run Horror walkthrough tests
      run: lua5.4 run-zil-test.lua tests.horror-walkthrough

    - name: Run horror failing conditions tests
      run: lua5.4 run-zil-test.lua tests.test-horror-failures

    - name: Run horror test helpers
      run: lua5.4 run-zil-test.lua tests.test-horror-helpers

    - name: Run parser/runtime tests - simple assertions
      run: lua5.4 run-zil-test.lua tests.test-simple-new

    - name: Run parser/runtime tests - insert file
      run: lua5.4 run-zil-test.lua tests.test-insert-file

    - name: Run parser/runtime tests - LET form
      run: lua5.4 run-zil-test.lua tests.test-let

    - name: Run parser/runtime tests - directions
      run: lua5.4 run-zil-test.lua tests.test-directions
    
    - name: Run parser/runtime tests - take
      run: lua5.4 run-zil-test.lua tests.test-take
    
    - name: Run parser/runtime tests - containers
      run: lua5.4 run-zil-test.lua tests.test-containers
    
    - name: Run parser/runtime tests - light
      run: lua5.4 run-zil-test.lua tests.test-light
    
    - name: Run parser/runtime tests - pronouns
      run: lua5.4 run-zil-test.lua tests.test-pronouns

    - name: Run parser/runtime tests - turnbit
      run: lua5.4 run-zil-test.lua tests.test-turnbit
    
    - name: Run parser/runtime tests - clock
      run: lua5.4 run-zil-test.lua tests.test-clock
    
    - name: Run parser/runtime tests - clock direct
      run: lua5.4 run-zil-test.lua tests.test-clock-direct
    
    - name: Run test assertion tests
      run: lua5.4 run-zil-test.lua tests.test-assertions
    
    - name: Run test check commands tests
      run: lua5.4 run-zil-test.lua tests.test-check-commands
